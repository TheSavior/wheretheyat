!function(){function t(){window.console||(window.console={log:function(){},warn:function(){},error:function(){}}),window.log=console.log.bind(console),n(["event","platform","data","load","managers/login","sections/map","fbHelper"],function(t,e,n,i,o,r,s){e.setHTMLDevices(),i.googPromise.then(function(){console.log("Google loaded"),r.start()}),i.fbPromise.then(function(){console.log("Facebook loaded"),FB.getLoginStatus(s.handleLoginResponse)})})}var e,n,i;!function(t){function o(t,e){return w.call(t,e)}function r(t,e){var n,i,o,r,s,a,c,u,l,h,d,f=e&&e.split("/"),p=_.map,m=p&&p["*"]||{};if(t&&"."===t.charAt(0))if(e){for(f=f.slice(0,f.length-1),t=t.split("/"),s=t.length-1,_.nodeIdCompat&&C.test(t[s])&&(t[s]=t[s].replace(C,"")),t=f.concat(t),l=0;l<t.length;l+=1)if(d=t[l],"."===d)t.splice(l,1),l-=1;else if(".."===d){if(1===l&&(".."===t[2]||".."===t[0]))break;l>0&&(t.splice(l-1,2),l-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((f||m)&&p){for(n=t.split("/"),l=n.length;l>0;l-=1){if(i=n.slice(0,l).join("/"),f)for(h=f.length;h>0;h-=1)if(o=p[f.slice(0,h).join("/")],o&&(o=o[i])){r=o,a=l;break}if(r)break;!c&&m&&m[i]&&(c=m[i],u=l)}!r&&c&&(r=c,a=u),r&&(n.splice(0,a,r),t=n.join("/"))}return t}function s(e,n){return function(){return f.apply(t,y.call(arguments,0).concat([e,n]))}}function a(t){return function(e){return r(e,t)}}function c(t){return function(e){g[t]=e}}function u(e){if(o(v,e)){var n=v[e];delete v[e],b[e]=!0,d.apply(t,n)}if(!o(g,e)&&!o(b,e))throw new Error("No "+e);return g[e]}function l(t){var e,n=t?t.indexOf("!"):-1;return n>-1&&(e=t.substring(0,n),t=t.substring(n+1,t.length)),[e,t]}function h(t){return function(){return _&&_.config&&_.config[t]||{}}}var d,f,p,m,g={},v={},_={},b={},w=Object.prototype.hasOwnProperty,y=[].slice,C=/\.js$/;p=function(t,e){var n,i=l(t),o=i[0];return t=i[1],o&&(o=r(o,e),n=u(o)),o?t=n&&n.normalize?n.normalize(t,a(e)):r(t,e):(t=r(t,e),i=l(t),o=i[0],t=i[1],o&&(n=u(o))),{f:o?o+"!"+t:t,n:t,pr:o,p:n}},m={require:function(t){return s(t)},exports:function(t){var e=g[t];return"undefined"!=typeof e?e:g[t]={}},module:function(t){return{id:t,uri:"",exports:g[t],config:h(t)}}},d=function(e,n,i,r){var a,l,h,d,f,_,w=[],y=typeof i;if(r=r||e,"undefined"===y||"function"===y){for(n=!n.length&&i.length?["require","exports","module"]:n,f=0;f<n.length;f+=1)if(d=p(n[f],r),l=d.f,"require"===l)w[f]=m.require(e);else if("exports"===l)w[f]=m.exports(e),_=!0;else if("module"===l)a=w[f]=m.module(e);else if(o(g,l)||o(v,l)||o(b,l))w[f]=u(l);else{if(!d.p)throw new Error(e+" missing "+l);d.p.load(d.n,s(r,!0),c(l),{}),w[f]=g[l]}h=i?i.apply(g[e],w):void 0,e&&(a&&a.exports!==t&&a.exports!==g[e]?g[e]=a.exports:h===t&&_||(g[e]=h))}else e&&(g[e]=i)},e=n=f=function(e,n,i,o,r){if("string"==typeof e)return m[e]?m[e](n):u(p(e,n).f);if(!e.splice){if(_=e,_.deps&&f(_.deps,_.callback),!n)return;n.splice?(e=n,n=i,i=null):e=t}return n=n||function(){},"function"==typeof i&&(i=o,o=r),o?d(t,e,n,i):setTimeout(function(){d(t,e,n,i)},4),f},f.config=function(t){return f(t)},e._defined=g,i=function(t,e,n){e.splice||(n=e,e=[]),o(g,t)||o(v,t)||(v[t]=[t,e,n])},i.amd={jQuery:!0}}(),i("almond",function(){}),i("event",[],function(){function t(){this.init()}return t.prototype={listeners:null,init:function(){this.listeners=[]},addListener:function(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)},removeListener:function(t,e){if(!this.listeners[t])return!1;var n=this.listeners[t].indexOf(e);return-1!==n?(delete this.listeners[t][n],!0):!1},trigger:function(t,e){return this.listeners[t]?(this.listeners[t].forEach(function(t){t(e)}),!0):!1}},new t}),i("load",["event"],function(t){function e(){this.init()}return e.prototype={fbPromise:null,_fbResolve:null,googPromise:null,_googResolve:null,fbAuthenticatedPromise:null,_fbAuthenticatedResolve:null,_domResolve:null,init:function(){this.fbPromise=new Promise(function(t){this._fbResolve=t}.bind(this)),this.googPromise=new Promise(function(t){this._googResolve=t}.bind(this)),this.fbAuthenticatedPromise=new Promise(function(t){this._fbAuthenticatedResolve=t}.bind(this))},fbLoaded:function(){this._fbResolve()},googLoaded:function(){this._googResolve()},fbAuthenticated:function(){this._fbAuthenticatedResolve()},_domLoaded:function(){this._domLoaded=!0,t.trigger("domLoaded"),this._check()},check:function(){return Promise.all([this._fbPromise,this._googPromise])}},new e}),i("class",[],function(){var t=!1,e=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;return this.Class=function(){},Class.extend=function(n){function i(){!t&&this.init&&this.init.apply(this,arguments)}var o=this.prototype;t=!0;var r=new this;t=!1;for(var s in n)r[s]="function"==typeof n[s]&&"function"==typeof o[s]&&e.test(n[s])?function(t,e){return function(){var n=this._super;this._super=o[t];var i=e.apply(this,arguments);return this._super=n,i}}(s,n[s]):n[s];return i.prototype=r,i.prototype.constructor=i,i.extend=arguments.callee,i},this.Class}),i("platform",["class"],function(t){var e=t.extend({_b:null,standalone:null,transition:null,transitionEnd:null,animation:null,transform:null,transformOrigin:null,mouseWheel:null,init:function(){this._b=document.body,this.standalone=!!window.navigator.standalone,this.transition=this.addPrefix("transition"),this.transitionEnd={transition:"transitionend",webkitTransition:"webkitTransitionEnd",MozTransition:"transitionEnd",OTransition:"oTransitionEnd"}[this.transition],this.animation=this.addPrefix("animation"),this.transform=this.addPrefix("transform"),this.transformOrigin=this.addPrefix("transformOrigin"),this.mouseWheel="undefined"!=typeof window.onwheel?"wheel":"mousewheel",window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)},window.indexedDB=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB||window.oIndexedDB},addPrefix:function(t){var e="",n=["ms","webkit","mox","o"],i=this._b.style;if("string"==typeof i[t])e="";else for(var o=0;o<n.length;o++)if("string"==typeof i["-"+n[o]+"-"+t]){e=n[o];break}var r=e.length>0?t.charAt(0).toUpperCase()+t.slice(1):t;return e?e+r:r},isiOS:function(){return this.hasDeviceType("iOS")},isPC:function(){return this.hasDeviceType("PC")},isMac:function(){return this.hasDeviceType("Mac")},isComputer:function(){return this.hasDeviceType("computer")},isPhone:function(){return this.hasDeviceType("phone")},isTablet:function(){return this.hasDeviceType("tablet")},isMobile:function(){return this.isPhone()||this.isTablet()},hasDeviceType:function(t){return-1!==this.getDeviceType().indexOf(t)},getDeviceType:function(){var t=[],e=navigator.userAgent;return e.match(/iPad/g)?(t.push("iOS"),t.push("iPad"),t.push("tablet")):e.match(/iPhone/g)?(t.push("iOS"),t.push("iPhone"),t.push("phone")):e.match(/Mac/g)?(t.push("Mac"),t.push("computer")):e.match(/Android/g)?(t.push("Android"),t.push(e.match(/Mobile/g)?"phone":"tablet")):(t.push("PC"),t.push("computer")),localStorage.deviceType=JSON.stringify(t),t},setHTMLDevices:function(){var t=this.getDeviceType(),e=document.body;t.forEach(function(t){e.classList.add(t)})}}),n=new e;return n}),i("dataLayer/fbData",["event"],function(t){function e(){this.init()}return e.prototype={init:function(){},getCheckins:function(t){var e;return e=new Promise(function(e,n){var i="me/home?with=location&fields=from,place,with_tags,object_id,type&date_format=U";i+="&limit=1000",t.until&&(i+="&until="+t.until),FB.api(i,function(t){return t?t.error?void n(new Error(t)):void e(t):void n(new Error("No response from Facebook"))})}.bind(this))},getFriends:function(){return new Promise(function(e,n){t.trigger("syncStateChanged",{status:"syncing",type:"friends",value:"fetching friends"}),FB.api("me/friends?fields=location,name",function(t){return t?t.error?void n(new Error(t)):void e(t.data):void n(new Error("No response from Facebook"))})}.bind(this)).then(function(e){var n=e.reduce(function(t,e){return e.location&&-1===t.indexOf(e.location.id)&&t.push(e.location.id),t},[]);return new Promise(function(i,o){t.trigger("syncStateChanged",{status:"syncing",type:"friends",value:"fetching cities"});var r={friends:e,locations:{}};return 0===n.length?void i(r):void FB.api("?ids="+n.join(",")+"&fields=location,name",function(t){return t?t.error?void o(new Error(t)):(r.locations=t,void i(r)):void o(new Error("No response from Facebook"))})})})}},new e}),i("dataLayer/data",["event","dataLayer/fbData"],function(t,e){function n(t){this.init(t)}return n.prototype={_backing:null,_checkins:null,_friendIds:null,_friendCities:null,_friendLocations:null,loadedPromise:null,init:function(t){this._checkins={},this._friendIds=[],this._friendCities={},this._friendLocations={},this._backing=t,this.loadedPromise=t.getCheckins().then(function(t){t.forEach(function(t){this._checkins[t.fbId]=t}.bind(this))}.bind(this)).then(function(){return localStorage.friends?this.getFriendCitiesGrouped():void 0}.bind(this)),localStorage.friendIds&&(this._friendIds=JSON.parse(localStorage.friendIds)),localStorage.friendLocations&&(this._friendLocations=JSON.parse(localStorage.friendLocations))},getCheckins:function(){return this._checkins},getFriends:function(){return this._friendIds},getCityFriends:function(){return this._friendCities},getPeopleFromData:function(t){for(var e=[],n=0;n<t.length;n++){var i=t[n];if(i.from.id&&i.place){var o=i.place.location.latitude,r=i.place.location.longitude,s=i.object_id||i.id,a={fbId:i.from.id,name:i.from.name,lat:o,"long":r,objectId:s,time:i.created_time};if(e.push(a),i.with_tags)for(var c=0;c<i.with_tags.data.length;c++){var u=i.with_tags.data[c],l={fbId:u.id,name:u.name,lat:o,"long":r,objectId:s,time:i.created_time};e.push(l)}}}return e},sync:function(){t.trigger("syncStateChanged",{status:"starting"});var e={until:null,since:parseInt(localStorage.newestCheckin)},n=0,i=!0;this.promiseWhile(function(){return i},function(){return Promise.all([this._getCheckinsPromise(e),this._syncFriendsPromise()]).then(function(e){var n=e[0];0===n.length&&(i=!1);var o=Promise.resolve();return e[1]&&e[1].length&&(o=o.then(function(){return this.getFriendCitiesGrouped()}.bind(this)).then(function(n){for(var i={},o=0;o<e[1].length;o++){var r=e[1][o];i[r]=n[r]}t.trigger("CitiesChanged",i),t.trigger("syncStateChanged",{status:"syncing",type:"friends",value:"finished",count:e[1].length})}.bind(this))),Promise.all([this._updateCheckinStorage(n),o])}.bind(this)).then(function(t){return t=t[0],e.until=t.oldestCheckin+1,t.repeatCheckin&&(i=!1),t}).then(function(e){n+=e.changes.added.length+e.changes.updated.length,t.trigger("syncStateChanged",{status:"syncing",type:"checkins",count:n}),t.trigger("CheckinsChanged",e.changes)})}.bind(this)).then(function(){t.trigger("syncStateChanged",{status:"finished",count:n})})["catch"](function(e){Rollbar.error("Error syncing",e),console.error(e,e.stack),t.trigger("syncStateChanged",{status:"error",error:e})})},promiseWhile:function(t,e){return new Promise(function(n,i){var o=function(){return t()?e().then(o)["catch"](function(t){i(t)}):n()};o()})},_syncFriendsPromise:function(){return!localStorage.lastUpdatedFriends||this.unixTimestamp()-localStorage.lastUpdatedFriends>3600?e.getFriends().then(function(t){for(var e=t.friends.map(function(t){return t.id}),n=t.friends.filter(function(t){return void 0!==t.location}),i={},o=0;o<n.length;o++){var r=n[o];r.fbId=r.id,r.city=r.location.id,delete r.id,delete r.location,i[r.fbId]=r.city}var s=Object.keys(t.locations).map(function(e){var n=t.locations[e];return{fbId:n.id,lat:n.location.latitude,"long":n.location.longitude}});return{ids:e,friends:n,locations:s,friendLocations:i}}.bind(this)).then(function(t){localStorage.friendIds=JSON.stringify(t.ids),localStorage.friends=JSON.stringify(t.friends),localStorage.friendLocations=JSON.stringify(t.friendLocations),localStorage.lastUpdatedFriends=this.unixTimestamp(),this._friendIds=t.ids;var e=[];for(var n in t.friendLocations){var i=this._friendLocations[n],o=t.friendLocations[n];i!==o&&(i&&-1===e.indexOf(i)&&e.push(i),o&&-1===e.indexOf(o)&&e.push(o))}return this._friendLocations=t.friendLocations,this._backing.storeLocations(t.locations).then(function(){return e})}.bind(this))["catch"](function(t){Rollbar.error("Error syncing friends",t),console.error(t)}):Promise.resolve()},_getCheckinsPromise:function(t){return e.getCheckins(t).then(function(t){return this.getPeopleFromData(t.data)}.bind(this))},_updateCheckinStorage:function(t){for(var e=[],n={added:[],updated:[]},i=!1,o=this.getFriends(),r=this.unixTimestamp(),s=0,a=0;a<t.length;a++){var c=t[a];-1!==o.indexOf(c.fbId)&&(this._checkins[c.fbId]?this._checkins[c.fbId].time<c.time?(n.updated.push(c),this._checkins[c.fbId]=c,e.push(this._backing.updateCheckin(c.fbId,c))):this._checkins[c.fbId].objectId===c.objectId&&(i=!0):(n.added.push(c),this._checkins[c.fbId]=c,e.push(this._backing.addCheckin(c))),r=Math.min(r,c.time),s=Math.max(s,c.time))}return localStorage.oldestCheckin=Math.min(parseInt(localStorage.oldestCheckin)||this.unixTimestamp(),r),localStorage.newestCheckin=Math.max(parseInt(localStorage.newestCheckin)||0,s),Promise.all(e).then(function(){return{changes:n,oldestCheckin:r,newestCheckin:s,repeatCheckin:i}})},getFriendCitiesGrouped:function(){return this._backing.getCityInfo().then(function(t){for(var e=JSON.parse(localStorage.friends),n=e.reduce(function(t,e){return t[e.city]||(t[e.city]={people:[]}),t[e.city].people.push({fbId:e.fbId,name:e.name}),t},{}),i=0;i<t.length;i++){var o=t[i];if(n[t[i].fbId]){var r=n[o.fbId];r.lat=o.lat,r["long"]=o["long"]}}return this._friendCities=n,n}.bind(this))},unixTimestamp:function(){return Math.round((new Date).getTime()/1e3)}},n}),i("db",[],function(){var t=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.oIndexedDB||window.msIndexedDB,e=window.IDBKeyRange||window.webkitIDBKeyRange,n={readonly:"readonly",readwrite:"readwrite"},i=Object.prototype.hasOwnProperty;if(t){var o=function(t){return t},r=function(){var t,e=[],n=function(n,i){if(e){i=i||[],t=t||[n,i];for(var o=0,r=e.length;r>o;o++)e[o].apply(t[0],t[1]);e=[]}};this.add=function(){for(var i=0,o=arguments.length;o>i;i++)e.push(arguments[i]);return t&&n(),this},this.execute=function(){return n(this,arguments),this}},s=function(t){var e="progress",n=[["resolve","done",new r,"resolved"],["reject","fail",new r,"rejected"],["notify","progress",new r]],i={},o={state:function(){return e},then:function(){var t=arguments;return s(function(e){n.forEach(function(n,o){var r=t[o];i[n[1]]("function"==typeof r?function(){var t=r.apply(this,arguments);t&&"function"==typeof t.promise&&t.promise().done(e.resolve).fail(e.reject).progress(e.notify)}:e[n[0]])})}).promise()},promise:function(t){return t?(Object.keys(o).forEach(function(e){t[e]=o[e]}),t):o}};return n.forEach(function(t){var n=t[2],r=t[3];o[t[1]]=n.add,r&&n.add(function(){e=r}),i[t[0]]=n.execute}),o.promise(i),t&&t.call(i,i),i},a=function(t){var e=this,o=!1;this.add=function(i){if(o)throw new Error("Database has been closed");for(var r=[],a=0;a<arguments.length-1;a++)r[a]=arguments[a+1];var c=t.transaction(i,n.readwrite),u=c.objectStore(i),l=s();return r.forEach(function(t){var e;if(t.item&&t.key){var n=t.key;t=t.item,e=u.add(t,n)}else e=u.add(t);e.onsuccess=function(e){var n=e.target,i=n.source.keyPath;null===i&&(i="__id__"),Object.defineProperty(t,i,{value:n.result,enumerable:!0}),l.notify()}}),c.oncomplete=function(){l.resolve(r,e)},c.onerror=function(t){var e=new Error;e.dbError=t,t.records=r,l.reject(e)},c.onabort=function(t){var e=new Error;e.dbError=t,t.records=r,l.reject(e)},l.promise()},this.update=function(i){if(o)throw new Error("Database has been closed");for(var r=[],a=0;a<arguments.length-1;a++)r[a]=arguments[a+1];var c=t.transaction(i,n.readwrite),u=c.objectStore(i),l=(u.keyPath,s());return r.forEach(function(t){var e;if(t.item&&t.key){var n=t.key;t=t.item,e=u.put(t,n)}else e=u.put(t);e.onsuccess=function(){l.notify()}}),c.oncomplete=function(){l.resolve(r,e)},c.onerror=function(t){var e=new Error;e.dbError=t,t.records=r,l.reject(e)},c.onabort=function(t){var e=new Error;e.dbError=t,t.records=r,l.reject(e)},l.promise()},this.remove=function(e,i){if(o)throw new Error("Database has been closed");{var r=t.transaction(e,n.readwrite),a=r.objectStore(e),c=s();a["delete"](i)}return r.oncomplete=function(){c.resolve(i)},r.onerror=function(t){var e=new Error;e.dbError=t,c.reject(e)},c.promise()},this.clear=function(e){if(o)throw new Error("Database has been closed");{var i=t.transaction(e,n.readwrite),r=i.objectStore(e),a=s();r.clear()}return i.oncomplete=function(){a.resolve()},i.onerror=function(t){var e=new Error;e.dbError=t,a.reject(e)},a.promise()},this.close=function(){if(o)throw new Error("Database has been closed");t.close(),o=!0},this.get=function(e,n){if(o)throw new Error("Database has been closed");var i=t.transaction(e),r=i.objectStore(e),a=s(),c=r.get(n);return c.onsuccess=function(t){a.resolve(t.target.result)},i.onerror=function(t){var e=new Error;e.dbError=t,a.reject(e)},a.promise()},this.query=function(e,n){if(o)throw new Error("Database has been closed");return new c(e,t,n)};for(var r=0,a=t.objectStoreNames.length;a>r;r++)!function(t){e[t]={};for(var n in e)i.call(e,n)&&"close"!==n&&(e[t][n]=function(n){return function(){var i=[t].concat([].slice.call(arguments,0));return e[n].apply(e,i)}}(n))}(t.objectStoreNames[r])},c=function(t,i,r){var a=this,c=!1,u=!1,l=function(o,a,l,h,d,f,p){var m=i.transaction(t,c||u?n.readwrite:n.readonly),g=m.objectStore(t),v=r?g.index(r):g,_=o?e[o].apply(null,a):null,b=[],w=s(),y=[_],d=d?d:null,f=f?f:[],C=0;"count"!==l&&y.push(h||"next");var E=c?Object.keys(c):!1,k=function(t){for(var e=0;e<E.length;e++){var n=E[e],i=c[n];i instanceof Function&&(i=i(t)),t[n]=i}return t},I=u instanceof Function?u:!1;return v[l].apply(v,y).onsuccess=function(t){var e=t.target.result;if("number"==typeof e)b=e;else if(e)if(null!==d&&d[0]>C)C=d[0],e.advance(d[0]);else if(null!==d&&C>=d[0]+d[1]);else{var n=!0,i="value"in e?e.value:e.key;f.forEach(function(t){t&&t.length&&(n=2===t.length?i[t[0]]===t[1]:t[0].apply(void 0,[i]))}),n&&(C++,b.push(p(i)),c&&(i=k(i),e.update(i)),u&&I(i)&&e["delete"](i)),e["continue"]()}},m.oncomplete=function(){w.resolve(b)},m.onerror=function(t){var e=new Error;e.dbError=t,w.reject(e)},m.onabort=function(t){var e=new Error;e.dbError=t,w.reject(e)},w.promise()},h=function(t,e){var n="next",i="openCursor",r=[],s=null,a=o,h=!1,d=function(){return l(t,e,i,h?n+"unique":n,s,r,a)},f=function(){return s=Array.prototype.slice.call(arguments,0,2),1==s.length&&s.unshift(0),{execute:d,modify:b,remove:w}},p=function(){return n=null,i="count",{execute:d}},m=function(){return i="openKeyCursor",{desc:v,execute:d,filter:g,distinct:_,map:y}},g=function(){return r.push(Array.prototype.slice.call(arguments,0,2)),{keys:m,execute:d,filter:g,desc:v,distinct:_,modify:b,remove:w,limit:f,map:y}},v=function(){return n="prev",{keys:m,execute:d,filter:g,distinct:_,modify:b,remove:w,map:y}},_=function(){return h=!0,{keys:m,count:p,execute:d,filter:g,desc:v,modify:b,remove:w,map:y}},b=function(t){return c=t,{execute:d}},w=function(t){return u="undefined"==typeof t?function(){return!0}:t,{execute:d}},y=function(t){return a=t,{execute:d,count:p,keys:m,filter:g,desc:v,distinct:_,modify:b,remove:w,limit:f,map:y}};return{execute:d,count:p,keys:m,filter:g,desc:v,distinct:_,modify:b,remove:w,limit:f,map:y}};"only bound upperBound lowerBound".split(" ").forEach(function(t){a[t]=function(){return new h(t,arguments)}}),this.filter=function(){var t=new h(null,null);return t.filter.apply(t,arguments)},this.all=function(){return this.filter()}},u=function(t,e,n){"function"==typeof e&&(e=e());for(var o in e){var r,s=e[o];r=!i.call(e,o)||n.objectStoreNames.contains(o)?t.currentTarget.transaction.objectStore(o):n.createObjectStore(o,s.key);for(var a in s.indexes)if(!r.indexNames.contains(a)){var c=s.indexes[a];r.createIndex(a,c.key||a,Object.keys(c).length?c:{unique:!1})}}},l=function(t,e){var n=t.target.result,i=new a(n,e),o=s();return o.resolve(i),o.promise()},h={version:"0.9.0",open:function(e){var n,i=s();return n=t.open(e.server,e.version),n.onsuccess=function(t){l(t,e.server,e.version,e.schema).done(i.resolve).fail(i.reject).progress(i.notify)},n.onupgradeneeded=function(t){u(t,e.schema,t.target.result)},n.onerror=function(t){var e=new Error;e.dbError=t,i.reject(e)},i.promise()}};return h}}),i("dataLayer/indexedDBBacking",["db"],function(t){function e(){this.init()}return e.prototype={readyPromise:null,init:function(){this.readyPromise=Promise.cast(t.open({server:"data",version:2,schema:{checkins:{key:{keyPath:"fbId"},indexes:{fbId:{unique:!0},time:{}}},locations:{key:{keyPath:"fbId"},indexes:{fbId:{unique:!0}}}}}))},getCheckins:function(){return this.readyPromise.then(function(t){return Promise.cast(t.checkins.query("fbId").all().desc().execute()).then(function(t){return t}.bind(this))}.bind(this))},addCheckin:function(t){return this.readyPromise.then(function(e){return Promise.cast(e.checkins.add(t))})},updateCheckin:function(t,e){return this.readyPromise.then(function(n){return Promise.cast(n.checkins.query("fbId").only(t).modify(e).execute()).then(function(t){return t}.bind(this))}.bind(this))},storeLocations:function(t){return this.readyPromise.then(function(e){function n(t){return Promise.cast(e.locations.query("fbId").only(t).count().execute()).then(function(t){return 0!==t}.bind(this))}var i=t.map(function(t){return n(t.fbId).then(function(n){return n?void 0:e.locations.add(t)})});return Promise.all(i)})},getCityInfo:function(){return this.readyPromise.then(function(t){return Promise.cast(t.locations.query("fbId").all().desc().execute()).then(function(t){return t}.bind(this))}.bind(this))}},e}),i("dataLayer/webSQLBacking",[],function(){function t(){this.init()}return t.prototype={_tableName:null,readyPromise:null,FIELDS:"fbId, lat, long, name, objectId, time",init:function(){this._tableName="checkins";var t=openDatabase("wheretheyat","","wheretheyat",4194304,function(){});this.readyPromise=new Promise(function(e,n){t.transaction(function(i){i.executeSql("CREATE TABLE IF NOT EXISTS `"+this._tableName+"`(fbId VARCHAR(255) PRIMARY KEY,lat REAL,long REAL,name VARCHAR(255),objectId VARCHAR(255),time INT)",[],function(){e(t)},function(t,e){n(e)})}.bind(this))}.bind(this)).then(function(t){return""===t.version?new Promise(function(e,n){t.changeVersion(t.version,"2",function(t){t.executeSql("CREATE TABLE IF NOT EXISTS `cities`(fbId VARCHAR(255) PRIMARY KEY,lat REAL,long REAL)",[],function(){e()},function(t,e){n(e)})}.bind(this))}):void 0}).then(function(){return t})},getCheckins:function(){return this.readyPromise.then(function(t){return new Promise(function(e,n){t.readTransaction(function(t){t.executeSql("SELECT "+this.FIELDS+" FROM `"+this._tableName+"`",[],function(t,n){var i=this._convertResultToObject(n);e(i)}.bind(this),function(t,e){n(e)})}.bind(this))}.bind(this))}.bind(this))},addCheckin:function(t){return this.readyPromise.then(function(e){return new Promise(function(n,i){e.transaction(function(e){e.executeSql("INSERT INTO `"+this._tableName+"` VALUES (?, ?, ?, ?, ?, ?)",[t.fbId,t.lat,t["long"],t.name,t.objectId,t.time],function(t,e){var i=this._convertResultToObject(e);n(i)}.bind(this),function(t,e){i(e)})}.bind(this))}.bind(this))}.bind(this))},updateCheckin:function(t,e){return this.readyPromise.then(function(n){return new Promise(function(i,o){n.transaction(function(n){n.executeSql("UPDATE `"+this._tableName+"` SET lat=?,long=?,name=?,objectId=?,time=? WHERE fbId = ?",[e.lat,e["long"],e.name,e.objectId,e.time,t],function(t,e){var n=this._convertResultToObject(e);i(n[0])}.bind(this),function(t,e){o(e)})}.bind(this))}.bind(this))}.bind(this))},storeLocations:function(t){return this.readyPromise.then(function(e){t.map(function(t){return new Promise(function(n,i){e.transaction(function(e){e.executeSql("INSERT OR IGNORE INTO `cities` (`fbId`, `lat`,`long`) VALUES(?,?,?)",[t.fbId,t.lat,t["long"]],function(){n()}.bind(this),function(t,e){i(e)})}.bind(this))}.bind(this))})})},getCityInfo:function(){return this.readyPromise.then(function(t){return new Promise(function(e,n){t.readTransaction(function(t){t.executeSql("SELECT * FROM `cities`",[],function(t,n){var i=this._convertResultToObject(n);e(i)}.bind(this),function(t,e){n(e)})}.bind(this))}.bind(this))}.bind(this))},_convertResultToObject:function(t){for(var e=t.rows,n=new Array(e.length),i=0;i<e.length;i++){var o=e.item(i);n[i]=o}return n}},t}),i("data",["dataLayer/data","dataLayer/indexedDBBacking","dataLayer/webSQLBacking"],function(t,e,n){var i;i=window.indexedDB?new e:new n;var o=new t(i);return o}),i("section",["class"],function(t){var e=t.extend({id:null,element:null,_visible:null,init:function(){this.id&&(this.element=document.getElementById(this.id)),this._visible=!1},setElement:function(t){this.element=t},show:null,hide:null,afterShow:function(){this.element&&(this.element.style.display="block"),this._visible=!0},afterHide:function(){this.element&&(this.element.style.display=""),this._visible=!1}});return e}),i("tapHandler",[],function(){function t(t,e){this.init(t,e)}return t.prototype={_element:null,_options:null,_distCutoff:20,_timeCutoff:500,_startType:null,_startTouchId:null,_startTime:null,_startX:null,_startY:null,_startDistance:null,_lastX:null,_lastY:null,_offset:null,_inGesture:!1,_ignoreGestures:!1,init:function(t,e){this._element=t,this._options=e,this._mouseDown=this._mouseDown.bind(this),this._touchDown=this._touchDown.bind(this),this._mouseMove=this._mouseMove.bind(this),this._touchMove=this._touchMove.bind(this),this._mouseUp=this._mouseUp.bind(this),this._touchUp=this._touchUp.bind(this),this._touchCancel=this._touchCancel.bind(this),this._down=this._down.bind(this),this._move=this._move.bind(this),this._end=this._end.bind(this),this._gestureStart=this._gestureStart.bind(this),this._gestureChange=this._gestureChange.bind(this),this._gestureEnd=this._gestureEnd.bind(this),this._offset={x:t.offsetLeft,y:t.offsetTop},this._element.addEventListener("mousedown",this._mouseDown),this._element.addEventListener("touchstart",this._touchDown)},ignoreGestures:function(t){this._ignoreGestures=t},_calculateMouseXY:function(t){t.x=t.clientX,t.y=t.clientY},_calculateTouchXY:function(t){var e=this._indexOfTouch(t,this._startTouchId);t.x=t.touches[e].clientX,t.y=t.touches[e].clientY},_calculateGestureXY:function(t){t.x=(t.touches[0].clientX+t.touches[1].clientX)/2,t.y=(t.touches[0].clientY+t.touches[1].clientY)/2},_mouseDown:function(t){this._startType="mouse",this._calculateMouseXY(t),this._down(t),document.addEventListener("mousemove",this._mouseMove),document.addEventListener("mouseup",this._mouseUp)},_touchDown:function(t){this._startType="touch",null===this._startTouchId&&(this._startTouchId=t.touches[t.touches.length-1].identifier),t.touches.length>=2&&!this._ignoreGestures?this._gestureStart(t):(this._calculateTouchXY(t),this._down(t)),document.addEventListener("touchmove",this._touchMove),document.addEventListener("touchend",this._touchUp),this._element.addEventListener("touchcancel",this._touchCancel)},_down:function(t){this._processEvent(t),this._startTime=Date.now(),this._startX=this._lastX=t.x,this._startY=this._lastY=t.y,this._options.start&&this._options.start(t)},_gestureStart:function(t){this._inGesture=!0,this._options.end&&(this._options.end(t),this._startTouchId=null),this._calculateGestureXY(t),this._startTime=Date.now(),this._startX=this._lastX=t.x,this._startY=this._lastY=t.y,this._startDistance=this._getGestureDistance(t),this._lastScale=1,this._options.gestureStart&&this._options.gestureStart(t)},_mouseMove:function(t){this._calculateMouseXY(t),this._move(t)},_touchMove:function(t){this._inGesture?this._gestureChange(t):(this._calculateTouchXY(t),this._move(t))},_move:function(t){this._processEvent(t),this._lastX=t.x,this._lastY=t.y,this._options.move&&this._options.move(t)},_gestureChange:function(t){this._calculateGestureXY(t),this._processEvent(t);var e=this._getGestureDistance(t);t.scale=e/this._startDistance,t.scaleFromLast=t.scale-this._lastScale,this._lastX=t.x,this._lastY=t.y,this._lastScale=t.scale,this._options.gesture&&this._options.gesture(t)},_mouseUp:function(t){document.removeEventListener("mousemove",this._mouseMove),document.removeEventListener("mouseup",this._mouseUp),this._end(t)},_touchUp:function(t){return this._inGesture?void this._gestureEnd(t):void(this._containsTouch(t,this._startTouchId)||(this._end(t),document.removeEventListener("touchmove",this._touchMove),document.removeEventListener("touchend",this._touchUp),this._touchCancel()))},_end:function(t){this._processEvent(t),t.wasTap=!1;var e=Math.sqrt((this._lastX-this._startX)*(this._lastX-this._startX)+(this._lastY-this._startY)*(this._lastY-this._startY));e<this._distCutoff&&Date.now()-this._startTime<this._timeCutoff&&(t.wasTap=!0,this._options.tap&&this._options.tap(t)),this._options.end&&this._options.end(t),this._startX=null,this._startY=null,t.preventDefault(),t.stopImmediatePropagation()},_touchCancel:function(){this._startTouchId=null,this._element.removeEventListener("touchcancel",this._touchCancel)},_gestureEnd:function(t){t.touches.length>=2||(this._inGesture=!1,this._options.gestureEnd&&this._options.gestureEnd(t),document.removeEventListener("touchmove",this._touchMove),document.removeEventListener("touchend",this._touchUp))},_processEvent:function(t){t.distFromLeft=t.x-this._offset.x,t.distFromTop=t.y-this._offset.y,t.xFromLast=t.x-this._lastX,t.yFromLast=t.y-this._lastY,t.distFromStartX=null!==this._startX?t.x-this._startX:0,t.distFromStartY=null!==this._startY?t.y-this._startY:0},_getGestureDistance:function(t){var e=t.touches[0].clientX-t.touches[1].clientX,n=t.touches[0].clientY-t.touches[1].clientY,i=Math.sqrt(e*e+n*n);return i},_containsTouch:function(t){return-1!==this._indexOfTouch(t,this._startTouchId)},_indexOfTouch:function(t,e){var n=-1;if(t.touches&&null!==e)for(var i=0;i<t.touches.length;i++)if(t.touches[i].identifier==e){n=i;break}return n},clear:function(){this._element.removeEventListener("mousedown",this._mouseDown),this._element.removeEventListener("touchstart",this._touchDown),document.removeEventListener("mousemove",this._mouseMove),document.removeEventListener("mouseup",this._mouseUp),document.removeEventListener("touchmove",this._touchMove),document.removeEventListener("touchend",this._touchUp)}},t}),function(t){function e(t,e,i){var u=0,l=[0],h="",d=null,h=i||"UTF8";if("UTF8"!==h&&"UTF16"!==h)throw"encoding must be UTF8 or UTF16";if("HEX"===e){if(0!==t.length%2)throw"srcString of HEX type must be in byte increments";d=o(t),u=d.binLen,l=d.value}else if("ASCII"===e||"TEXT"===e)d=n(t,h),u=d.binLen,l=d.value;else{if("B64"!==e)throw"inputFormat must be HEX, TEXT, ASCII, or B64";d=r(t),u=d.binLen,l=d.value}this.getHash=function(t,e,n,i){var o,r=null,h=l.slice(),d=u;if(3===arguments.length?"number"!=typeof n&&(i=n,n=1):2===arguments.length&&(n=1),n!==parseInt(n,10)||1>n)throw"numRounds must a integer >= 1";switch(e){case"HEX":r=s;break;case"B64":r=a;break;default:throw"format must be HEX or B64"}if("SHA-224"===t)for(o=0;n>o;o++)h=b(h,d,t),d=224;else{if("SHA-256"!==t)throw"Chosen SHA variant is not supported";for(o=0;n>o;o++)h=b(h,d,t),d=256}return r(h,c(i))},this.getHMAC=function(t,e,i,d,f){var p,m,g,v,_=[],w=[];switch(p=null,d){case"HEX":d=s;break;case"B64":d=a;break;default:throw"outputFormat must be HEX or B64"}if("SHA-224"===i)m=64,v=224;else{if("SHA-256"!==i)throw"Chosen SHA variant is not supported";m=64,v=256}if("HEX"===e)p=o(t),g=p.binLen,p=p.value;else if("ASCII"===e||"TEXT"===e)p=n(t,h),g=p.binLen,p=p.value;else{if("B64"!==e)throw"inputFormat must be HEX, TEXT, ASCII, or B64";p=r(t),g=p.binLen,p=p.value}for(t=8*m,e=m/4-1,g/8>m?(p=b(p,g,i),p[e]&=4294967040):m>g/8&&(p[e]&=4294967040),m=0;e>=m;m+=1)_[m]=909522486^p[m],w[m]=1549556828^p[m];return i=b(w.concat(b(_.concat(l),t+u,i)),t+v,i),d(i,c(f))
}}function n(t,e){var n,i,o=[],r=[],s=0;if("UTF8"===e)for(i=0;i<t.length;i+=1)for(n=t.charCodeAt(i),r=[],n>2048?(r[0]=224|(61440&n)>>>12,r[1]=128|(4032&n)>>>6,r[2]=128|63&n):n>128?(r[0]=192|(1984&n)>>>6,r[1]=128|63&n):r[0]=n,n=0;n<r.length;n+=1)o[s>>>2]|=r[n]<<24-s%4*8,s+=1;else if("UTF16"===e)for(i=0;i<t.length;i+=1)o[s>>>2]|=t.charCodeAt(i)<<16-s%4*8,s+=2;return{value:o,binLen:8*s}}function o(t){var e,n,i=[],o=t.length;if(0!==o%2)throw"String of HEX type must be in byte increments";for(e=0;o>e;e+=2){if(n=parseInt(t.substr(e,2),16),isNaN(n))throw"String of HEX type contains invalid characters";i[e>>>3]|=n<<24-e%8*4}return{value:i,binLen:4*o}}function r(t){var e,n,i,o,r,s=[],a=0;if(-1===t.search(/^[a-zA-Z0-9=+\/]+$/))throw"Invalid character in base-64 string";if(e=t.indexOf("="),t=t.replace(/\=/g,""),-1!==e&&e<t.length)throw"Invalid '=' found in base-64 string";for(n=0;n<t.length;n+=4){for(r=t.substr(n,4),i=o=0;i<r.length;i+=1)e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(r[i]),o|=e<<18-6*i;for(i=0;i<r.length-1;i+=1)s[a>>2]|=(o>>>16-8*i&255)<<24-a%4*8,a+=1}return{value:s,binLen:8*a}}function s(t,e){var n,i,o="",r=4*t.length;for(n=0;r>n;n+=1)i=t[n>>>2]>>>8*(3-n%4),o+="0123456789abcdef".charAt(i>>>4&15)+"0123456789abcdef".charAt(15&i);return e.outputUpper?o.toUpperCase():o}function a(t,e){var n,i,o,r="",s=4*t.length;for(n=0;s>n;n+=3)for(o=(t[n>>>2]>>>8*(3-n%4)&255)<<16|(t[n+1>>>2]>>>8*(3-(n+1)%4)&255)<<8|t[n+2>>>2]>>>8*(3-(n+2)%4)&255,i=0;4>i;i+=1)r=8*n+6*i<=32*t.length?r+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(o>>>6*(3-i)&63):r+e.b64Pad;return r}function c(t){var e={outputUpper:!1,b64Pad:"="};try{t.hasOwnProperty("outputUpper")&&(e.outputUpper=t.outputUpper),t.hasOwnProperty("b64Pad")&&(e.b64Pad=t.b64Pad)}catch(n){}if("boolean"!=typeof e.outputUpper)throw"Invalid outputUpper formatting option";if("string"!=typeof e.b64Pad)throw"Invalid b64Pad formatting option";return e}function u(t,e){return t>>>e|t<<32-e}function l(t,e,n){return t&e^~t&n}function h(t,e,n){return t&e^t&n^e&n}function d(t){return u(t,2)^u(t,13)^u(t,22)}function f(t){return u(t,6)^u(t,11)^u(t,25)}function p(t){return u(t,7)^u(t,18)^t>>>3}function m(t){return u(t,17)^u(t,19)^t>>>10}function g(t,e){var n=(65535&t)+(65535&e);return((t>>>16)+(e>>>16)+(n>>>16)&65535)<<16|65535&n}function v(t,e,n,i){var o=(65535&t)+(65535&e)+(65535&n)+(65535&i);return((t>>>16)+(e>>>16)+(n>>>16)+(i>>>16)+(o>>>16)&65535)<<16|65535&o}function _(t,e,n,i,o){var r=(65535&t)+(65535&e)+(65535&n)+(65535&i)+(65535&o);return((t>>>16)+(e>>>16)+(n>>>16)+(i>>>16)+(o>>>16)+(r>>>16)&65535)<<16|65535&r}function b(t,e,n){var i,o,r,s,a,c,u,b,w,y,C,E,k,I,P,S,L,x,T,j,A,D,M,O,F,B,R=[],H=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];if(y=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428],i=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],"SHA-224"!==n&&"SHA-256"!==n)throw"Unexpected error in SHA-2 implementation";for(C=64,I=16,P=1,F=Number,S=g,L=v,x=_,T=p,j=m,A=d,D=f,O=h,M=l,y="SHA-224"===n?y:i,t[e>>>5]|=128<<24-e%32,t[(e+65>>>9<<4)+15]=e,B=t.length,E=0;B>E;E+=I){for(e=y[0],i=y[1],o=y[2],r=y[3],s=y[4],a=y[5],c=y[6],u=y[7],k=0;C>k;k+=1)R[k]=16>k?new F(t[k*P+E],t[k*P+E+1]):L(j(R[k-2]),R[k-7],T(R[k-15]),R[k-16]),b=x(u,D(s),M(s,a,c),H[k],R[k]),w=S(A(e),O(e,i,o)),u=c,c=a,a=s,s=S(r,b),r=o,o=i,i=e,e=S(b,w);y[0]=S(e,y[0]),y[1]=S(i,y[1]),y[2]=S(o,y[2]),y[3]=S(r,y[3]),y[4]=S(s,y[4]),y[5]=S(a,y[5]),y[6]=S(c,y[6]),y[7]=S(u,y[7])}if("SHA-224"===n)t=[y[0],y[1],y[2],y[3],y[4],y[5],y[6]];else{if("SHA-256"!==n)throw"Unexpected error in SHA-2 implementation";t=y}return t}"function"==typeof i?i("vendor/sha256",[],function(){return e}):"undefined"!=typeof exports?"undefined"!=typeof module&&module.exports?module.exports=exports=e:exports=e:t.jsSHA=e}(this),i("analytics",["event","vendor/sha256"],function(t,e){function n(){this.init()}return n.prototype={init:function(){},setUserId:function(t){var n=new e(t,"TEXT").getHash("SHA-256","HEX");ga("set","&uid",n),ga("send","event","logged in")},pageView:function(t){ga("send","pageview",{page:window.location.pathname+window.location.hash,title:t})},event:function(){var t=[].splice.call(arguments,0);t=["send","event"].concat(t),ga.apply(ga,t)}},new n}),i("fbHelper",["event","load","analytics"],function(t,e,n){function i(){this.init()}return i.prototype={_isLoggedIn:!1,init:function(){this.handleLoginResponse=this.handleLoginResponse.bind(this)},handleLoginResponse:function(i){"connected"===i.status?(console.log("Logged in."),e.fbAuthenticated(),FB.api("/me",{fields:"id, email"},function(e){if(!e||e.error)console.error("Error fetching profile information");else{if(this._isLoggedIn=!0,n.setUserId(e.id),localStorage.isLoggedIn)n.event("logged in");else{n.event("registered");var i=new XMLHttpRequest;i.open("POST","http://wheretheyat-log.herokuapp.com",!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),i.send("email="+e.email)}t.trigger("authenticatedStatusChanged",{loggedIn:!0})}}.bind(this))):(this._isLoggedIn=!1,console.warn("User not logged in"),localStorage.isLoggedIn&&t.trigger("authenticatedStatusChanged",{loggedIn:!1}))},isLoggedIn:function(){return this._isLoggedIn}},new i}),i("sections/landingPage",["event","section","tapHandler","load","fbHelper","analytics","platform"],function(t,e,n,i,o,r,s){var a=e.extend({id:"landingPage",_loginElement:null,init:function(){this._super(),this._loginElement=document.getElementById("login");var t=document.getElementById("map");this.element.addEventListener("scroll",function(){var e=this.element.scrollTop;t.style[s.transform]="translateY(-"+e/3+"px)"}.bind(this)),new n(document.getElementById("about"),{tap:this._aboutLinksTapped.bind(this)}),new n(document.getElementById("seen"),{tap:this._seenLinksTapped.bind(this)}),i.fbPromise.then(function(){this._loginElement.textContent="Sign in with Facebook",this._loginElement.classList.remove("disabled"),new n(this._loginElement,{tap:this._loginTapped.bind(this)})}.bind(this))},_loginTapped:function(){o.isLoggedIn()?t.trigger("showPage","app"):FB.login(o.handleLoginResponse,{scope:"email,user_friends,read_stream,user_checkins,friends_checkins,user_status,friends_status"})},_aboutLinksTapped:function(t){"SPAN"===t.target.tagName&&(t.stopPropagation(),t.preventDefault(),r.event("link","social",t.target.dataset.type),window.location=t.target.parentNode.href)},_seenLinksTapped:function(t){"IMG"===t.target.tagName&&(t.stopPropagation(),t.preventDefault(),r.event("link","seen",t.target.dataset.type),window.location=t.target.parentNode.href)},show:function(){console.log("showing landing page"),this._loginElement.textContent=o.isLoggedIn()?"Back To The App":"Loading Facebook"},afterShow:function(){this.element.style.display="block",setTimeout(function(){document.body.classList.remove("open")},0),this._visible=!0},afterHide:function(){if(this.element){document.body.classList.add("open");var t=function(){this.element.style.display="none",this.element.removeEventListener("transitionend",t)}.bind(this);this.element.addEventListener("transitionend",t)}this._visible=!1}});return new a}),i("template",[],function(){function t(t){var e=document.getElementById("template-"+t),n=document.createElement("div");return n.innerHTML=e.innerHTML,n.children[0]}return t}),i("sections/map",["event","section","template","analytics"],function(t,e,n,i){var o=e.extend({id:"map",_locations:null,_people:null,_homeCities:null,_infoWindow:null,_pinSVGPath:"M16 0c-5.523 0-10 4.477-10 10 0 10 10 22 10 22s10-12 10-22c0-5.523-4.477-10-10-10zM16 16.125c-3.383 0-6.125-2.742-6.125-6.125s2.742-6.125 6.125-6.125 6.125 2.742 6.125 6.125-2.742 6.125-6.125 6.125zM12.125 10c0-2.14 1.735-3.875 3.875-3.875s3.875 1.735 3.875 3.875c0 2.14-1.735 3.875-3.875 3.875-2.14 0-3.875-1.735-3.875-3.875z",_infoWindowTemplate:null,_infoWindowCheckinItemTemplate:null,_infoWindowCityItemTemplate:null,_idleListener:null,init:function(){this._super(),t.addListener("CheckinsChanged",this._checkinsChanged.bind(this)),t.addListener("CitiesChanged",this._citiesChanged.bind(this)),this._infoWindowTemplate=new n("infobox"),this._infoWindowCheckinItemTemplate=new n("infoboxCheckinItem"),this._infoWindowCityItemTemplate=new n("infoboxCityItem")},start:function(){this._locations={},this._markers={},this._map=new google.maps.Map(this.element,{disableDefaultUI:!0,mapTypeId:google.maps.MapTypeId.ROADMAP}),this._map.setCenter(this._getCenter()||new google.maps.LatLng(0,0)),this._map.setZoom(this._getZoom()||3),this._infoWindow=new google.maps.InfoWindow({content:""}),google.maps.event.addListener(this._map,"click",function(){this._infoWindow.close()}.bind(this)),this._idleListener=google.maps.event.addListener(this._map,"idle",function(){this._saveMap()}.bind(this))},show:function(){this.element.style.zIndex=0},hide:function(){this.element.style.zIndex=-1},_openInfo:function(t,e){return function(){i.event("infobox","opened"),this._infoWindow.close(),this._infoWindow.setContent(e),this._infoWindow.open(this._map,t)}.bind(this)},_getMarker:function(){return{path:this._pinSVGPath,scale:1,strokeWeight:1,strokeColor:"white",fillColor:"#ad24ab",fillOpacity:1,anchor:new google.maps.Point(16,32)}},loadData:function(t,e){var n=this._groupPeopleByLocation(t);this._locations=n.locations,this._people=n.people,this._homeCities=e;var i=Object.keys(n.locations);this._drawCheckins(i),this._drawCities(Object.keys(e))},_drawCities:function(t){t.forEach(function(t){var e=this._homeCities[t];if(!e){var n={cityId:t};return Rollbar.info("City is not defined",n),void console.warn("City is not defined",n)}var i=e.people,o=new google.maps.LatLng(e.lat,e["long"]),r=this._getMarker();r.path=google.maps.SymbolPath.CIRCLE,r.scale=6,r.anchor=void 0;var s={position:o,map:this._map,icon:r},a=document.createElement("div");a.appendChild(this._buildCityInfoBoxContent(i));var c=a.innerHTML,u=new google.maps.Marker(s);location.marker=u,e.marker=u,google.maps.event.addListener(u,"click",this._openInfo(u,c).bind(this))}.bind(this))},_drawCheckins:function(t){for(var e=0;e<t.length;e++){var n=t[e],i=this._locations[n],o=i.people,r=new google.maps.LatLng(o[0].lat,o[0]["long"]),s={position:r,map:this._map,icon:this._getMarker()},a=document.createElement("div");a.appendChild(this._buildCheckinInfoBoxContent(o));var c=a.innerHTML,u=new google.maps.Marker(s);i.marker=u,google.maps.event.addListener(u,"click",this._openInfo(u,c).bind(this))}},_buildCityInfoBoxContent:function(t){t.sort(function(t,e){var n=t.name,i=e.name;return n==i?0:n>i?1:i>n?-1:void 0});for(var e=this._infoWindowTemplate.cloneNode(!0),n=e.getElementsByClassName("content")[0],i=0;i<t.length;i++){var o=t[i],r=this._infoWindowCityItemTemplate.cloneNode(!0);r.getElementsByClassName("link")[0].href="http://facebook.com/"+o.fbId,r.getElementsByClassName("name")[0].textContent=o.name,n.appendChild(r)}return e},_buildCheckinInfoBoxContent:function(t){for(var e=this._infoWindowTemplate.cloneNode(!0),n=e.getElementsByClassName("content")[0],i=0;i<t.length;i++){var o=t[i],r=this._infoWindowCheckinItemTemplate.cloneNode(!0);r.getElementsByClassName("link")[0].href="http://facebook.com/"+o.objectId,r.getElementsByClassName("picture")[0].src="http://graph.facebook.com/"+o.fbId+"/picture",r.getElementsByClassName("name")[0].textContent=o.name,r.getElementsByClassName("time")[0].textContent=this._convertTime(o.time)+" ago",n.appendChild(r)}return e},_checkinsChanged:function(t){var e=[];t.updated.forEach(function(t){var n=this._people[t.fbId],i=this._locations[n];if(1==i.people.length)i.marker.setMap(null),delete this._locations[n];else for(var o=0;o<i.people.length;o++)if(i.people[o].fbId==t.fbId){i.people.splice(o,1),e.push(n);break}i.marker.setMap(null),i.marker=null}.bind(this));var n=t.added.concat(t.updated),i=this._groupPeopleByLocation(n);Object.keys(i.locations).forEach(function(t){this._locations[t]?(this._locations[t].people.concat(i.locations[t].people),this._locations[t].marker&&(this._locations[t].marker.setMap(null),this._locations[t].marker=null)):this._locations[t]=i.locations[t],e.push(t)}.bind(this)),this._drawCheckins(e)},_citiesChanged:function(t){for(var e in t)this._homeCities[e]&&this._homeCities[e].marker.setMap(null),this._homeCities[e]=t[e];var n=Object.keys(t);this._drawCities(n)},_groupPeopleByLocation:function(t){return Object.keys(t).reduce(function(e,n){var i=t[n],o=i.lat+","+i["long"];return e.locations[o]||(e.locations[o]={people:[],marker:null}),e.locations[o].people.push(i),e.people[i.fbId]=o,e},{locations:{},people:{}})},_convertTime:function(t){var e=new Date(1e3*t),n=Math.floor((new Date-e)/1e3),i=Math.floor(n/31536e3);return i>1?i+" years":(i=Math.floor(n/2592e3),i>1?i+" months":(i=Math.floor(n/86400),i>1?i+" days":(i=Math.floor(n/3600),i>1?i+" hours":(i=Math.floor(n/60),i>1?i+" minutes":Math.floor(n)+" seconds"))))},_getCenter:function(){if(!localStorage.center)return!1;var t=JSON.parse(localStorage.center),e=new google.maps.LatLng(t[0],t[1]);return e},_getZoom:function(){return localStorage.zoom?JSON.parse(localStorage.zoom):!1},_saveMap:function(){var t=this._map.getCenter(),e=this._map.getZoom(),n=[t.lat(),t.lng()];localStorage.center=JSON.stringify(n),localStorage.zoom=JSON.stringify(e)}});return new o}),i("sections/syncMessage",["event","section"],function(t,e){var n=e.extend({id:"syncMessage",init:function(){this._super(),t.addListener("syncStateChanged",this._syncStateChanged.bind(this))},_syncStateChanged:function(t){log("Sync Status:",t.status),this._promiseChain="starting"===t.status?this._process(t):this._promiseChain.then(function(){return this._process(t)}.bind(this)),"error"===t.status&&(console.error(message),console.error(t.error)),this._promiseChain=this._promiseChain.then(function(){return this._delay()}.bind(this))},_process:function(t){return new Promise(function(e){var n="";"starting"===t.status?(n="Starting",this.element.textContent=n,this.afterShow()):"syncing"===t.status?"checkins"==t.type?(n="Syncing... "+t.count+" new checkins.",this.element.textContent=n):"friends"==t.type&&("fetching friends"==t.value?this.element.textContent="Fetching Friends List":"fetching cities"==t.value?this.element.textContent="Fetching City Information":"finished"==t.value&&(this.element.textContent="Updating "+t.count+" Home Cities")):"finished"===t.status?(n="Done. "+t.count+" new checkins.",this.element.textContent=n,this._promiseChain=this._promiseChain.then(function(){return this._delay()}.bind(this)).then(function(){this.afterHide()}.bind(this))):"error"===t.status&&(n="Error Syncing",this.element.textContent=n,this._promiseChain=this._promiseChain.then(function(){return this._delay()}.bind(this)).then(function(){this.afterHide()}.bind(this))),e()}.bind(this))},_delay:function(){return new Promise(function(t){setTimeout(function(){t()},1e3)})},afterShow:function(){this.element.style.opacity=1,this._visible=!0},afterHide:function(){this.element.style.opacity=0,this._visible=!1}});return new n}),i("sections/app",["event","section","data","load","tapHandler","sections/map","sections/syncMessage"],function(t,e,n,i,o,r){var s=e.extend({id:"hud",_lastSync:null,init:function(){this._super(),new o(document.getElementById("logo"),{tap:this._logoTapped.bind(this)})},_logoTapped:function(){t.trigger("showPage","landingPage")},show:function(){Promise.all([n.loadedPromise,i.googPromise]).then(function(){var t=n.getCheckins();log("Populating map with",Object.keys(t).length+" checkins");var e=n.getCityFriends();log("Populating map with",Object.keys(e).length+" home cities"),r.loadData(t,e)}.bind(this)),i.fbAuthenticatedPromise.then(function(){var t=Math.round(Date.now()/1e3);t-this._lastSync>60&&(n.sync(),this._lastSync=t)}.bind(this))},afterShow:function(){this._super(),r.show()},afterHide:function(){this._super(),r.hide()}});return new s}),i("managers/login",["event","sections/landingPage","sections/app","analytics"],function(t,e,n,i){function o(){this.init()}return o.prototype={pages:null,currentPage:"",init:function(){this.pages={},t.addListener("authenticatedStatusChanged",this._authenticatedStatusChanged.bind(this)),t.addListener("showPage",this._showPage.bind(this)),this.pages.landingPage=e,this.pages.app=n,"true"===localStorage.isLoggedIn?(document.body.classList.add("open"),this.setPage("app")):this.setPage("landingPage"),window.m=this},setPage:function(t){if(this.currentPage!=t){var e=null;this.currentPage&&(e=this.pages[this.currentPage],e.hide&&e.hide(),e.afterHide()),e=this.pages[t],e.show&&e.show(),e.afterShow(),this.currentPage=t,i.pageView(t)}},_authenticatedStatusChanged:function(t){t.loggedIn?(localStorage.isLoggedIn=!0,this.setPage("app")):(delete localStorage.isLoggedIn,this.setPage("landingPage"))},_showPage:function(t){this.setPage(t)}},new o}),function(){var t,e,n,i;!function(){var o={},r={};t=function(t,e,n){o[t]={deps:e,callback:n}},i=n=e=function(t){function n(e){if("."!==e.charAt(0))return e;for(var n=e.split("/"),i=t.split("/").slice(0,-1),o=0,r=n.length;r>o;o++){var s=n[o];if(".."===s)i.pop();else{if("."===s)continue;i.push(s)}}return i.join("/")}if(i._eak_seen=o,r[t])return r[t];if(r[t]={},!o[t])throw new Error("Could not find module "+t);for(var s,a=o[t],c=a.deps,u=a.callback,l=[],h=0,d=c.length;d>h;h++)l.push("exports"===c[h]?s={}:e(n(c[h])));var f=u.apply(this,l);return r[t]=s||f}}(),t("promise/all",["./utils","exports"],function(t,e){function n(t){var e=this;if(!i(t))throw new TypeError("You must pass an array to all.");return new e(function(e,n){function i(t){return function(e){r(t,e)}}function r(t,n){a[t]=n,0===--c&&e(a)}var s,a=[],c=t.length;0===c&&e([]);for(var u=0;u<t.length;u++)s=t[u],s&&o(s.then)?s.then(i(u),n):r(u,s)})}var i=t.isArray,o=t.isFunction;e.all=n}),t("promise/asap",["exports"],function(t){function e(){return function(){process.nextTick(o)}}function n(){var t=0,e=new c(o),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=t=++t%2}}function i(){return function(){u.setTimeout(o,1)}}function o(){for(var t=0;t<l.length;t++){var e=l[t],n=e[0],i=e[1];n(i)}l=[]}function r(t,e){var n=l.push([t,e]);1===n&&s()}var s,a="undefined"!=typeof window?window:{},c=a.MutationObserver||a.WebKitMutationObserver,u="undefined"!=typeof global?global:this,l=[];s="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?e():c?n():i(),t.asap=r}),t("promise/cast",["exports"],function(t){function e(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var e=this;return new e(function(e){e(t)})}t.cast=e}),t("promise/config",["exports"],function(t){function e(t,e){return 2!==arguments.length?n[t]:void(n[t]=e)}var n={instrument:!1};t.config=n,t.configure=e}),t("promise/polyfill",["./promise","./utils","exports"],function(t,e,n){function i(){var t="Promise"in window&&"cast"in window.Promise&&"resolve"in window.Promise&&"reject"in window.Promise&&"all"in window.Promise&&"race"in window.Promise&&function(){var t;return new window.Promise(function(e){t=e}),r(t)}();t||(window.Promise=o)}var o=t.Promise,r=e.isFunction;n.polyfill=i}),t("promise/promise",["./config","./utils","./cast","./all","./race","./resolve","./reject","./asap","exports"],function(t,e,n,i,o,r,s,a,c){function u(t){if(!C(t))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof u))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=[],l(t,this)}function l(t,e){function n(t){m(e,t)}function i(t){v(e,t)}try{t(n,i)}catch(o){i(o)}}function h(t,e,n,i){var o,r,s,a,c=C(n);if(c)try{o=n(i),s=!0}catch(u){a=!0,r=u}else o=i,s=!0;p(e,o)||(c&&s?m(e,o):a?v(e,r):t===j?m(e,o):t===A&&v(e,o))}function d(t,e,n,i){var o=t._subscribers,r=o.length;o[r]=e,o[r+j]=n,o[r+A]=i}function f(t,e){for(var n,i,o=t._subscribers,r=t._detail,s=0;s<o.length;s+=3)n=o[s],i=o[s+e],h(e,n,i,r);t._subscribers=null}function p(t,e){var n,i=null;try{if(t===e)throw new TypeError("A promises callback cannot return that same promise.");if(y(e)&&(i=e.then,C(i)))return i.call(e,function(i){return n?!0:(n=!0,void(e!==i?m(t,i):g(t,i)))},function(e){return n?!0:(n=!0,void v(t,e))}),!0}catch(o){return n?!0:(v(t,o),!0)}return!1}function m(t,e){t===e?g(t,e):p(t,e)||g(t,e)}function g(t,e){t._state===x&&(t._state=T,t._detail=e,w.async(_,t))}function v(t,e){t._state===x&&(t._state=T,t._detail=e,w.async(b,t))}function _(t){f(t,t._state=j)}function b(t){f(t,t._state=A)}var w=t.config,y=(t.configure,e.objectOrFunction),C=e.isFunction,E=(e.now,n.cast),k=i.all,I=o.race,P=r.resolve,S=s.reject,L=a.asap;w.async=L;var x=void 0,T=0,j=1,A=2;u.prototype={constructor:u,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(t,e){var n=this,i=new this.constructor(function(){});if(this._state){var o=arguments;w.async(function(){h(n._state,i,o[n._state-1],n._detail)})}else d(this,i,t,e);return i},"catch":function(t){return this.then(null,t)}},u.all=k,u.cast=E,u.race=I,u.resolve=P,u.reject=S,c.Promise=u}),t("promise/race",["./utils","exports"],function(t,e){function n(t){var e=this;if(!i(t))throw new TypeError("You must pass an array to race.");return new e(function(e,n){for(var i,o=0;o<t.length;o++)i=t[o],i&&"function"==typeof i.then?i.then(e,n):e(i)})}var i=t.isArray;e.race=n}),t("promise/reject",["exports"],function(t){function e(t){var e=this;return new e(function(e,n){n(t)})}t.reject=e}),t("promise/resolve",["exports"],function(t){function e(t){var e=this;return new e(function(e){e(t)})}t.resolve=e}),t("promise/utils",["exports"],function(t){function e(t){return n(t)||"object"==typeof t&&null!==t}function n(t){return"function"==typeof t}function i(t){return"[object Array]"===Object.prototype.toString.call(t)}var o=Date.now||function(){return(new Date).getTime()};t.objectOrFunction=e,t.isFunction=n,t.isArray=i,t.now=o}),e("promise/polyfill").polyfill()}(),i("promise",function(){}),window.OFFLINE=!1,window.initFb=function(){n(["load"],function(t){t.fbLoaded()})},window.initGoog=function(){n(["load"],function(t){t.googLoaded()})},"interactive"===document.readyState||"complete"===document.readyState?t():document.addEventListener("DOMContentLoaded",t,!1),window.Promise||n(["promise"],function(t){console.warn("Loading Promise polyfill"),window.Promise=t}),i("main",function(){})}();
//# sourceMappingURL=main.min.js
//# sourceMappingURL=main.min.js.map